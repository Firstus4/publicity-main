{% extends 'base.html' %}

<h1 class="logo"><a href="/">{% block logo %} ADMIN | DASHBOARD {% endblock %}</a></h1>
{% block title %} DASHBOARD | NCCF KEBBI {% endblock %}

{% block nav %}
<nav class="nav-bar">
    <a href="{{ url_for('admin.add_admin') }}" class="btn btn-success mb-3">Add New Admin</a>
    <a href="{{ url_for('admin.list_admins') }}" class="btn btn-info mb-3">View All Admins</a>
    <a href="{{ url_for('admin.logout') }}" class="btn btn-danger mb-3">Logout</a>
</nav>
{% endblock %}


{% block nav_url %}/admin/add_admin{% endblock %}
{% block nav_text %}Add New Admin{% endblock %}
    


{% block body %} 
</head>
<hr>
</br>
<div class="body">
    <div class="stats">
        <div class="stat-card">
            <div class="stat-number">{{ students|length }}</div>
            <div>Total Students</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ students|selectattr('photo_filename')|list|length }}</div>
            <div>With Photos</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ students|groupby('state')|list|length }}</div>
            <div>Different States</div>
        </div>
    </div>

    <div class="students-table">
        <div class="table-header">
            <h2>Registered Students</h2>
        </div>
        
        {% if students %}
            <input type="text" id="searchInput" class="search-box" placeholder="Search students..." style="margin: 20px;">
            
            <table id="studentsTable">
                <thead>
                    <tr>
                        <th>Photo</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>State/LGA</th>
                        <th>School</th>
                        <th>Unit</th>
                        <th>Room</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for student in students %}
                    <tr>
                        <td class="photo-cell">
                            {% if student.photo_filename %}
                                <img src="{{ url_for('public.uploaded_file', filename=student.photo_filename) }}" alt="Student Photo">
                            {% else %}
                                <div style="width:50px;height:50px;background:#eee;display:flex;align-items:center;justify-content:center;border-radius:4px;">ðŸ“·</div>
                            {% endif %}
                        </td>
                        <td>
                            <strong>{{ student.first_name }} {{ student.middle_name or '' }} {{ student.last_name }}</strong><br>
                            <small>{{ student.sex }} â€¢ {{ student.dob }}</small>
                        </td>
                        <td>{{ student.email }}</td>
                        <td>{{ student.phone }}</td>
                        <td>{{ student.state }}<br><small>{{ student.lga }}</small></td>
                        <td>{{ student.school }}</td>
                        <td>{{ student.unit }}</td>
                        <td>{{ student.room_allocated }}</td>
                        <td>
                            <a href="{{ url_for('admin.edit_student', student_id=student.id) }}" class="btn btn-edit">Edit</a>
                            <form method="POST" action="{{ url_for('admin.delete_student', student_id=student.id) }}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete {{ student.first_name }} {{ student.last_name }}?');">
                                <button type="submit" class="btn btn-delete">Delete</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <div class="no-data">
                <h3>No students registered yet</h3>
                <p>Students will appear here once they complete the registration form.</p>
                <p><a href="/">Go to Registration Form</a></p>
            </div>
        {% endif %}
    </div>

    <script>
        // Simple search functionality
        document.getElementById('searchInput').addEventListener('keyup', function() {
            const searchTerm = this.value.toLowerCase();
            const tableRows = document.querySelectorAll('#studentsTable tbody tr');
            
            tableRows.forEach(function(row) {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });
    </script>
</div>
</html>
{% endblock %}
